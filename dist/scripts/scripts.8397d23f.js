"use strict";angular.module("sexyWeather",["nlForm"]);var nlForm=angular.module("nlForm",["ngSanitize"]);nlForm.directive("nlSelect",function(){return{restrict:"EA",replace:!0,scope:{value:"=",options:"="},controller:"nlSelectCtrl",template:"<div ng-form='nlSelect' class='nl-field nl-dd' ng-class=\"{'nl-field-open': opened}\"><a class='nl-field-toggle' ng-click='open($event)' ng-bind='getSelected()'></a><ul><li ng-show='allOptions && multiple && !isAllSelected()' ng-bind='allOptions' ng-click='selectAll()'></li><li ng-repeat='label in getLabels()' ng-class=\"{'nl-dd-checked': isSelected(label)}\" ng-click='select(label)' ng-bind='label'></li><li ng-show='multiple && !isNoneSelected()' ng-bind='none' ng-click='selectNone()'></li> </ul></div>",link:function(a,b,c){a.required=!angular.isUndefined(c.required),a.multiple=!angular.isUndefined(c.multiple),a.conjunction=a.multiple&&""!==c.multiple?c.multiple:"and",a.none=angular.isUndefined(c.none)?"none":c.none,a.allOptions=angular.isUndefined(c.all)?!1:c.all,a.multiple&&angular.isUndefined(a.value)&&(a.value=[]),a.multiple&&!angular.isArray(a.value)&&(a.value=[a.value]);var d=!1;angular.forEach(b.parent().children(),function(a){a=angular.element(a),a.hasClass("nl-overlay")&&(d=a)}),d||(d=angular.element('<div class="nl-overlay"></div>'),b.parent().append(d)),d.bind("click",function(){a.$apply(a.close)})}}}).controller("nlSelectCtrl",["$scope",function(a){function b(b){var c=!1;return angular.forEach(a.options,function(d){switch(a.optionType){case i:case k:b==d&&(c=!0);break;case j:case l:b==d.value&&(c=!0)}}),c}function c(){switch(a.optionType){case i:case j:return a.options.length;case l:case k:var b=0;return angular.forEach(a.options,function(){b++}),b}return 0}function d(b){if(b<c()&&b>=0)switch(a.optionType){case i:return{value:a.options[0],label:a.options[0]};case j:return a.options[0];case k:case l:var d=null,e=0;return angular.forEach(a.options,function(c,f){e==b&&(d=a.optionType==k?{value:c,label:f}:c),e++}),d}return{value:"",label:""}}function e(b){var c=b;switch(a.optionType){case j:case l:angular.forEach(a.options,function(a){a.value==b&&(c=a.label)});break;case i:break;case k:angular.forEach(a.options,function(a,d){b==a&&(c=d)})}return c}function f(b){var c=b;switch(a.optionType){case i:break;case j:angular.forEach(a.options,function(a){a.label==b&&(c=a.value)});break;case k:c=a.options[b];break;case l:c=a.options[b].value}return c}function g(b){var c=b;switch(a.optionType){case i:break;case k:angular.forEach(a.options,function(a,d){b==a&&(c=d)});break;case j:angular.forEach(a.options,function(a){a.value==b.value&&(c=a.label)});break;case l:angular.forEach(a.options,function(a,d){b==a&&(c=d)})}return c}function h(){if(a.multiple){var c=[];angular.forEach(a.value,function(a){b(a)&&c.push(a)}),a.value=c}else b(a.value)||(a.value=d(0).value)}var i=1,j=2,k=3,l=4;a.opened=!1,a.open=function(b){b.stopPropagation(),a.opened=!0},a.close=function(){a.opened=!1},a.select=function(b){a.setValue(b),a.close()},a.selectAll=function(){angular.forEach(a.options,function(b){var c=g(b);a.isSelected(c)||a.select(c),a.close()})},a.selectNone=function(){angular.forEach(a.options,function(b){var c=g(b);a.isSelected(c)&&a.select(c),a.close()})},a.isAllSelected=function(){return!angular.isUndefined(a.value)&&a.value.length==c()},a.isNoneSelected=function(){return angular.isUndefined(a.value)||0===a.value.length},a.setValue=function(b){var c=f(b);if(a.multiple){var d=a.value.indexOf(c);-1==d?a.value.push(c):a.value.splice(d,1),a.required&&(0===a.value.length?a.nlSelect.$setValidity("required",!1):a.nlSelect.$setValidity("required",!0))}else a.value=c},a.getLabels=function(){switch(a.optionType){case i:return a.options;case j:return a.options.map(function(a){return a.label});case k:case l:var b=[];return angular.forEach(a.options,function(c,d){b.push(a.optionType==k?d:c.label)}),b}return[]},a.getSelected=function(){if(a.multiple){var b="";if(!angular.isUndefined(a.value)&&a.value.length>0)if(a.allOptions&&a.value.length==c())b=a.allOptions;else{var d="",f=1;angular.forEach(a.value,function(c){b+=d+e(c),f++,d=a.value.length>2?", ":" ",f==a.value.length&&(d+=a.conjunction+" ")})}else b=a.none;return b}return e(a.value)},a.isSelected=function(b){return angular.isUndefined(a.value)?!1:a.multiple?a.value.indexOf(f(b))>-1:a.value==f(b)},a.$watch("options",function(){if(a.optionType=null,angular.isArray(a.options))a.optionType=angular.isObject(a.options[0])?j:i;else if(angular.isObject(a.options))for(var b in a.options)if(a.options.hasOwnProperty(b)){a.optionType=angular.isObject(a.options[b])?l:k;break}h()},!0)}]),nlForm.directive("nlText",function(){return{restrict:"EA",replace:!0,scope:{placeholder:"@",subline:"@",name:"@",value:"="},template:'<div ng-form class="nl-field nl-ti-text" ng-class="{\'nl-field-open\': opened}"><a class="nl-field-toggle" ng-click="open($event)" ng-bind="viewValue()"></a><ul><li class="nl-ti-input"><input type="text" placeholder="{{ placeholder }}" name="{{ name }}" ng-model="value" ng-click="$event.stopPropagation()" ng-required="required"/><button class="nl-field-go" ng-click="close()">Go</button></li><li class="nl-ti-example" ng-show="showSubline()" ng-bind-html="subline"></li></ul></div>',controller:"nlTextCtrl",link:function(a,b,c){a.required=!angular.isUndefined(c.required);var d=!1;angular.forEach(b.parent().children(),function(a){a=angular.element(a),a.hasClass("nl-overlay")&&(d=a)}),d||(d=angular.element('<div class="nl-overlay"></div>'),b.parent().append(d)),d.bind("click",function(){a.$apply(a.close)})}}}).controller("nlTextCtrl",["$scope",function(a){a.opened=!1,a.open=function(b){b.stopPropagation(),a.opened=!0},a.close=function(){a.opened=!1},a.viewValue=function(){return""===a.value?a.placeholder:a.value},a.showSubline=function(){return angular.isString(a.subline)&&""!==a.subline}}]),angular.module("sexyWeather").directive("youtubePlayer",["$sce",function(a){return{restrict:"EA",scope:{code:"="},replace:!0,template:'<div style="height:400px;"><iframe style="overflow:hidden;height:100%;width:100%" width="100%" height="100%" src="{{url}}" frameborder="0" allowfullscreen></iframe></div>',link:function(b){b.$watch("code",function(c){b.url="tooSexy"===c?"":a.trustAsResourceUrl("http://www.youtube.com/embed/"+c+"?autoplay=1&iv_load_policy=3&enablejsapi=1")})}}}]),angular.module("sexyWeather").factory("utilities",[function(){return{kToF:function(a){return Math.floor(1.8*a-459.67)},inRange:function(a,b,c){return c>=a&&b>=c}}}]),angular.module("sexyWeather").controller("MainCtrl",["$scope","$http","$q","utilities",function(a,b,c,d){a.whens=["today","tomorrow","this week"],a.response={when:"today",where:"New York"},a.subline="For example: <em>New York</em> or <em>River Edge</em>",a.isSexy=0,a.sexyVideo=null;var e=function(a,e){var f=[],g=c.defer();return b.get(a).success(function(a){e>1?a.list.forEach(function(a){f.push({min:d.kToF(a.temp.min),max:d.kToF(a.temp.max)})}):f.push({min:d.kToF(a.main.temp_min),max:d.kToF(a.main.temp_max),now:d.kToF(a.main.temp)}),g.resolve(f)}),g.promise},f=function(a,b){var c="http://api.openweathermap.org/data/2.5/",d="&APPID=e464e0c345e366e776a6e248c5428112";return a?c+"forecast/daily?q="+b+"&cnt=7&mode=json"+d:c+"weather?q="+b+d};a.tooSexy=function(){a.isSexy=0,a.sexyVideo="tooSexy"},a.getWeather=function(){var b=a.response,c="",g=0;"today"===b.when?(c=f(!1,b.where),g=1):"tomorrow"===b.when?(c=f(!0,b.where),g=2):"this week"===b.when&&(c=f(!0,b.where),g=7),a.isSexy=0,e(c,g).then(function(b){2===g?d.inRange(b[0].min,b[0].max,69)&&(a.isSexy=2,a.sexyVideo="39YUXIKrOFk"):(b.forEach(function(b){d.inRange(b.min,b.max,69)&&(a.isSexy=2,a.sexyVideo="39YUXIKrOFk")}),2!==a.isSexy&&(a.isSexy=1))})}}]);